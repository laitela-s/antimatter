<!DOCTYPE html>
<html lang="ko" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>ê°•í™” ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class', theme: { extend: { colors: { slate: { 850: '#1e293b', 900: '#0f172a' } } } } }</script>
    <style>
        ::-webkit-scrollbar {
            width: 4px
        }

        ::-webkit-scrollbar-track {
            background: transparent
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0
        }

        * {
            -webkit-tap-highlight-color: transparent
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-100 min-h-screen pb-10">
    <div class="max-w-3xl mx-auto px-4 pt-6">
        <header class="mb-6 text-center">
            <h1
                class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-indigo-500 bg-clip-text text-transparent mb-1">
                ê°•í™” ì‹œë®¬ë ˆì´í„° Pro</h1>
            <p class="text-xs text-slate-400"><span class="text-red-400 font-medium">âš ï¸</span> 5ê°• ì´ìƒ, ì˜µì…˜ ì¥ë¹„ ì „ìš©</p>
        </header>
        <div class="space-y-4 mb-8">
            <div class="bg-slate-800 rounded-xl shadow-lg border border-slate-700/50">
                <div class="px-5 py-3 border-b border-slate-700">
                    <h2 class="text-sm font-semibold text-purple-300">ğŸ›¡ï¸ ì¥ë¹„ ì •ë³´</h2>
                </div>
                <div class="p-5 grid grid-cols-2 gap-4">
                    <div><label class="block text-[10px] text-slate-400 mb-1">í˜„ì¬ ë‹¨ê³„</label><select id="enhance_level"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none appearance-none">
                            <option value="" disabled selected>ì„ íƒ</option>
                            <option value="5">5ê°•</option>
                            <option value="6">6ê°•</option>
                            <option value="7">7ê°•</option>
                            <option value="8">8ê°•</option>
                            <option value="9">9ê°•</option>
                        </select></div>
                    <div><label class="block text-[10px] text-slate-400 mb-1">ë‚´êµ¬ë„</label><input id="durability"
                            type="number"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none"
                            placeholder="ì…ë ¥"></div>
                    <div><label class="block text-[10px] text-slate-400 mb-1">ë ™ì œ</label><input id="equip" type="number"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none"
                            placeholder="ì˜ˆ: 70">
                        <p class="text-[9px] text-slate-500 mt-1">ê°•í™” ë¹„ìš© ê³„ì‚°ìš©</p>
                    </div>
                    <div><label class="block text-[10px] text-slate-400 mb-1">íŠ¼íŠ¼í•œ ì¥ë¹„</label><select id="dur_flag"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none appearance-none">
                            <option value="" disabled selected>ì„ íƒ</option>
                            <option value="o">ì˜ˆ</option>
                            <option value="x">ì•„ë‹ˆì˜¤</option>
                        </select></div>
                </div>
            </div>
            <div class="bg-slate-800 rounded-xl shadow-lg border border-slate-700/50">
                <div class="px-5 py-3 border-b border-slate-700">
                    <h2 class="text-sm font-semibold text-green-300">ğŸ’ ì¬ë£Œ ë¹„ìš©</h2>
                </div>
                <div class="p-5 grid grid-cols-2 gap-4">
                    <div><label class="block text-[10px] text-slate-400 mb-1">ê°•í™”ì„ ëŒ€ë© (ì–µ)</label><input id="stone_bulk"
                            type="number" step="0.1"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none"
                            placeholder="ë¹„ìš©">
                        <p class="text-[9px] text-slate-500 mt-1">ì¬ë£Œë¹„ ê³„ì‚°ìš©</p>
                    </div>
                    <div><label class="block text-[10px] text-slate-400 mb-1">ê°•ë ˆ (ë§Œ/ë ˆì•Œ)</label><input id="rea"
                            type="number" step="1"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none"
                            placeholder="ë‹¨ê°€">
                        <p class="text-[9px] text-slate-500 mt-1">ë³´í˜¸ì œ ë¹„ìš© ê³„ì‚°ìš©</p>
                    </div>
                </div>
            </div>
            <div class="bg-slate-800 rounded-xl shadow-lg border border-slate-700/50">
                <div class="px-5 py-3 border-b border-slate-700">
                    <h2 class="text-sm font-semibold text-blue-300">ğŸ’° íŒë§¤ ê°€ê²©</h2>
                </div>
                <div class="p-5 grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <p class="text-[10px] text-slate-400 mb-3">ìµœì¢… ê²°ê³¼ë¬¼ íŒë§¤ê°€ (ê¸°ëŒ€ê°€ì¹˜ ì‚°ì¶œìš©)</p>
                    </div>
                    <div><label class="block text-[10px] text-slate-400 mb-1">7ê°• (ì–µ)</label><input id="sale7"
                            type="number" step="0.1"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none">
                    </div>
                    <div><label class="block text-[10px] text-slate-400 mb-1">8ê°• (ì–µ)</label><input id="sale8"
                            type="number" step="0.1"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none">
                    </div>
                    <div><label class="block text-[10px] text-slate-400 mb-1">9ê°• (ì–µ)</label><input id="sale9"
                            type="number" step="0.1"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none">
                    </div>
                    <div><label class="block text-[10px] text-slate-400 mb-1">10ê°• (ì–µ)</label><input id="sale10"
                            type="number" step="0.1"
                            class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm outline-none">
                    </div>
                </div>
            </div>
            <div class="bg-slate-800 rounded-xl shadow-lg border border-slate-700/50">
                <div class="px-5 py-3 border-b border-slate-700">
                    <h2 class="text-sm font-semibold text-yellow-300">ğŸ“Š í˜„ì¬ ì‹œì„¸ (ì„ íƒ)</h2>
                </div>
                <div class="p-5"><label class="block text-[10px] text-slate-400 mb-1">í˜„ì¬ ì¥ë¹„ ì‹œì„¸ (ì–µ)</label><input
                        id="market_price" type="number" step="0.1"
                        class="text-white w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-3 text-sm outline-none"
                        placeholder="ì„ íƒ">
                    <p class="text-[9px] text-slate-500 mt-2">ROI ë¹„êµìš©<br><span class="text-yellow-500">â€» ì„ íƒì‚¬í•­</span></p>
                </div>
            </div>
            <div class="px-2">
                <div class="flex justify-between text-xs text-slate-400 mb-1"><span>ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜</span><span
                        id="trials-label" class="text-slate-300 font-mono">200,000</span></div>
                <p class="text-[9px] text-slate-500 mb-2">ë†’ì„ìˆ˜ë¡ ì •í™•í•˜ë‚˜ ì‹œê°„ ì†Œìš”</p><input id="trials" type="range"
                    min="100000" max="1000000" step="10000" value="200000"
                    class="w-full h-2 bg-slate-700 rounded-lg accent-blue-500"
                    oninput="document.getElementById('trials-label').innerText=parseInt(this.value).toLocaleString()">
            </div>
            <button onclick="calculate()"
                class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-4 px-6 rounded-xl shadow-lg flex justify-center items-center gap-2"><svg
                    class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>ë¶„ì„ ì‹œì‘</button>
        </div>
        <div id="result-container" class="hidden">
            <div class="bg-slate-800 rounded-xl p-5 shadow-xl border border-slate-700 relative">
                <div
                    class="bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-5 text-[11px] text-blue-200 flex gap-2 items-start leading-snug">
                    <svg class="w-4 h-4 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p>ì‹œë®¬ë ˆì´ì…˜ íŠ¹ì„±ìƒ ë§¤ë²ˆ ë¯¸ì„¸í•œ í¸ì°¨ ë°œìƒ ê°€ëŠ¥</p>
                </div>
                <div id="roi-badge" class="hidden absolute top-0 right-0 m-5"></div>
                <h2 class="text-base font-bold mb-4 flex items-center gap-2">ğŸ“Š ë¶„ì„ ê²°ê³¼</h2>
                <div id="result-content" class="space-y-6"></div>
            </div>
        </div>
        <div id="loading" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50" style="display:none">
            <div class="h-full flex flex-col items-center justify-center">
                <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4">
                </div>
                <p class="text-blue-400 font-medium">ë¶„ì„ ì¤‘...</p>
            </div>
        </div>
    </div>
    <script>
        const SR = [1, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1];
        const SRD = [1, 0.92, 0.83, 0.75, 0.67, 0.58, 0.5, 0.42, 0.33, 0.25];
        const SC = [1, 2, 3, 5, 10, 20, 30, 50, 100, 200];
        const PC = [1, 2, 3, 4, 8, 10, 15, 20, 30, 50];

        function gold_cost(e, c) {
            let b;
            if (e <= 69) b = Math.round(10 * e ** 2.5 / 10) * 10;
            else if (e === 70) b = 958000;
            else if (e >= 71 && e <= 79) b = 2000000;
            else if (e === 80) b = 3303400;
            else if (e === 90) b = 7290000;
            else b = Math.round(10 * e ** 2.5 / 10) * 10;
            return b * (2 ** c);
        }

        function sim_trial(l, d, t10, t9, t8, e, u, s, p, sale) {
            let cost = 0, cl = l, cd = d;
            while (cl < 10 && cd > cl) {
                let prot = false;
                if (cd >= 10) prot = cl >= t10;
                else if (cd === 9) prot = cl >= t9;
                else if (cd === 8) prot = cl >= t8;

                let base = u ? SRD[cl] : SR[cl];
                let eff = prot ? Math.min(base + 0.2, 1.0) : base;

                if (prot) {
                    cost += PC[cl] * p;
                } else {
                    cost += gold_cost(e, cl) + SC[cl] * s;
                }

                if (Math.random() < eff) {
                    cl++;
                } else {
                    if (prot) {
                        cd--;
                    } else {
                        if (Math.random() < (cl / 10.0)) {
                            return { finalLevel: 0, cost: cost };
                        } else {
                            cd--;
                        }
                    }
                }
            }
            return { finalLevel: cl, cost: cost };
        }

        function sim_price(n, l, d, t10, t9, t8, e, u, s, p, sale) {
            let sum = 0;
            for (let i = 0; i < n; i++) {
                let r = sim_trial(l, d, t10, t9, t8, e, u, s, p, sale);
                if (r.finalLevel >= 7) {
                    sum += (sale[r.finalLevel] || 0) - r.cost;
                } else {
                    sum -= r.cost;
                }
            }
            return sum / n;
        }

        function sim_stats(n, l, d, t10, t9, t8, e, u, s, p) {
            let c = { 10: 0, 9: 0, 8: 0, 7: 0, 0: 0 };
            for (let i = 0; i < n; i++) {
                let r = sim_trial(l, d, t10, t9, t8, e, u, s, p, {});
                if (r.finalLevel >= 7) {
                    c[r.finalLevel] = (c[r.finalLevel] || 0) + 1;
                } else {
                    c[0]++;
                }
            }
            return {
                10: (c[10] / n) * 100,
                9: (c[9] / n) * 100,
                8: (c[8] / n) * 100,
                7: (c[7] / n) * 100
            };
        }

        function format_gold(x) {
            let a = Math.abs(x);
            let s = x < 0 ? "-" : "";
            a = Math.round(a / 1000) * 1000;
            let o = Math.floor(a / 100000000);
            let m = Math.floor((a % 100000000) / 10000);
            let p = [];
            if (o > 0) p.push(o + "ì–µ");
            if (m > 0) p.push(m + "ë§Œ");
            return p.length > 0 ? s + p.join(" ") : "0";
        }

        function saveInputs() {
            localStorage.setItem("enhancerInputsPro", JSON.stringify({
                market_price: document.getElementById("market_price").value,
                sale7: document.getElementById("sale7").value,
                sale8: document.getElementById("sale8").value,
                sale9: document.getElementById("sale9").value,
                sale10: document.getElementById("sale10").value,
                enhance_level: document.getElementById("enhance_level").value,
                durability: document.getElementById("durability").value,
                stone_bulk: document.getElementById("stone_bulk").value,
                rea: document.getElementById("rea").value,
                equip: document.getElementById("equip").value,
                dur_flag: document.getElementById("dur_flag").value,
                trials: document.getElementById("trials").value
            }));
        }

        function loadInputs() {
            const i = JSON.parse(localStorage.getItem("enhancerInputsPro"));
            if (i) {
                document.getElementById("market_price").value = i.market_price || "";
                document.getElementById("sale7").value = i.sale7 || "";
                document.getElementById("sale8").value = i.sale8 || "";
                document.getElementById("sale9").value = i.sale9 || "";
                document.getElementById("sale10").value = i.sale10 || "";
                document.getElementById("enhance_level").value = i.enhance_level || "";
                document.getElementById("durability").value = i.durability || "";
                document.getElementById("stone_bulk").value = i.stone_bulk || "";
                document.getElementById("rea").value = i.rea || "";
                document.getElementById("equip").value = i.equip || "";
                document.getElementById("dur_flag").value = i.dur_flag || "";
                // trials restoration removed
            }
        }

        document.addEventListener("DOMContentLoaded", loadInputs);
        document.querySelectorAll("input,select").forEach(e => e.addEventListener("input", saveInputs));

        function calculate() {
            saveInputs();
            document.getElementById("loading").style.display = "block";
            document.getElementById("result-container").classList.add("hidden");

            setTimeout(() => {
                const mp = parseFloat(document.getElementById("market_price").value) * 1e8 || 0;
                const s7 = parseFloat(document.getElementById("sale7").value) * 1e8 || 0;
                const s8 = parseFloat(document.getElementById("sale8").value) * 1e8 || 0;
                const s9 = parseFloat(document.getElementById("sale9").value) * 1e8 || 0;
                const s10 = parseFloat(document.getElementById("sale10").value) * 1e8 || 0;
                const sb = parseFloat(document.getElementById("stone_bulk").value) * 1e8 || 0;
                const r = parseFloat(document.getElementById("rea").value) * 1e4 || 0;
                const eq = parseFloat(document.getElementById("equip").value) || 0;
                const ds = document.getElementById("dur_flag").value?.trim().toLowerCase();
                const tr = parseInt(document.getElementById("trials").value) || 200000;

                let sale = { 7: s7, 8: s8, 9: s9, 10: s10 };
                let cl = parseInt(document.getElementById("enhance_level").value);
                let id = parseInt(document.getElementById("durability").value);

                if (isNaN(cl) || cl < 5 || isNaN(id) || !ds) {
                    alert("ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
                    document.getElementById("loading").style.display = "none";
                    return;
                }

                let su = sb / 400;
                let pf = 10 * r;
                let ud = ds === 'o';
                let fev = 0;
                let bst = "";
                let c10 = 100, c9 = 100, c8 = 100;
                let sef = true;
                let stop78 = false;

                // Fix: Changed id <= 8 to id < 8 to include 8 in optimization logic
                if (id < 8) {
                    fev = sim_price(tr, cl, id, 100, 100, 100, eq, ud, su, pf, sale);
                    bst = `<div class="text-sm text-slate-300">ë‚´êµ¬ë„ ë‚®ìŒ (<span class="text-red-400 font-bold">${id}</span>)</div><div class="text-lg font-bold text-white mt-1">ê¹¡ê°•í™” ì¶”ì²œ</div>`;
                } else {
                    // Step 1: Optimize th10 (Protection start level for Durability 10+)
                    let bestTh10 = 100;
                    if (id >= 10) {
                        let lb = -1e99;
                        // Search from current level up to 10 (inclusive) as requested
                        for (let ca = cl; ca <= 10; ca++) {
                            // Test with th10=ca, others default (100)
                            let exp = sim_price(tr, cl, id, ca, 100, 100, eq, ud, su, pf, sale, false);
                            if (exp > lb) {
                                lb = exp;
                                bestTh10 = ca;
                            }
                        }
                        // Check if NOT using protection (100) is better
                        let en = sim_price(tr, cl, id, 100, 100, 100, eq, ud, su, pf, sale, false);
                        if (en > lb) bestTh10 = 100;

                        // User Rule: If bestTh10 is 10, it means "No Protection"
                        if (bestTh10 === 10) bestTh10 = 100;
                    }

                    // Step 2: Optimize th9 (Protection start level for Durability 9)
                    let bestTh9 = 100;
                    if (id >= 9) {
                        let lb = -1e99;
                        // Search from current level up to 9 (inclusive)
                        for (let ca = cl; ca <= 9; ca++) {
                            // Test with th9=ca, using bestTh10, th8=100
                            let exp = sim_price(tr, cl, id, bestTh10, ca, 100, eq, ud, su, pf, sale, false);
                            if (exp > lb) {
                                lb = exp;
                                bestTh9 = ca;
                            }
                        }
                        let en = sim_price(tr, cl, id, bestTh10, 100, 100, eq, ud, su, pf, sale, false);
                        if (en > lb) bestTh9 = 100;

                        // User Rule: If bestTh9 is 9, it means "No Protection"
                        if (bestTh9 === 9) bestTh9 = 100;
                    }

                    // Step 3: Optimize th8 (Protection start level for Durability 8)
                    let bestTh8 = 100;
                    if (id >= 8) {
                        let lb = -1e99;
                        // Search from current level up to 8 (inclusive)
                        for (let ca = cl; ca <= 8; ca++) {
                            // Test with th8=ca, using bestTh10, bestTh9
                            let exp = sim_price(tr, cl, id, bestTh10, bestTh9, ca, eq, ud, su, pf, sale, false);
                            if (exp > lb) {
                                lb = exp;
                                bestTh8 = ca;
                            }
                        }
                        let en = sim_price(tr, cl, id, bestTh10, bestTh9, 100, eq, ud, su, pf, sale, false);
                        if (en > lb) bestTh8 = 100;

                        // User Rule: If bestTh8 is 8, it means "No Protection"
                        if (bestTh8 === 8) bestTh8 = 100;
                    }

                    c10 = bestTh10;
                    c9 = bestTh9;
                    c8 = bestTh8;

                    // Step 4: Check Stop at 7/8 Strategy
                    if (cl <= 7 && id >= 8 && s7 > 0 && s8 > 0) {
                        let sa7 = s7;
                        // Compare Sell@7 vs Continue Enhancing (using best strategies found) starting from 7/8 state
                        // Logic: Simulate from 7/8 with established strategies
                        let tf8 = sim_price(tr, 7, 8, c10, c9, c8, eq, ud, su, pf, sale, false);

                        // If Selling 7 is greater than Expected Value of Continuing, recommend Stop
                        if (sa7 > tf8) {
                            stop78 = true;
                        }
                    }
                }

                // Final Calculation:
                // Run simulation with determined strategies (c10, c9, c8) and stop flag (stop78)
                // This accounts for the ACTUAL starting state (cur_lvl, durability)
                // If stop78 is true, sim_price/sim_stats will handle the logic inside sim_trial
                fev = sim_price(tr, cl, id, c10, c9, c8, eq, ud, su, pf, sale, stop78);

                // Build Strategy Text
                if (id < 8) {
                    // bst is already set above for low durability
                } else {
                    let ss = [];
                    if (id >= 10) ss.push(c10 === 100 ? '<span class="text-slate-400">ë‚´êµ¬10+:</span> <strong>ë¯¸ì‚¬ìš©</strong>' : `<span class="text-slate-400">ë‚´êµ¬10+:</span> <strong class="text-blue-400">${c10}ê°•</strong>ë¶€í„°`);
                    if (id >= 9) ss.push(c9 === 100 ? '<span class="text-slate-400">ë‚´êµ¬9:</span> <strong>ë¯¸ì‚¬ìš©</strong>' : `<span class="text-slate-400">ë‚´êµ¬9:</span> <strong class="text-blue-400">${c9}ê°•</strong>ë¶€í„°`);
                    if (id >= 8) ss.push(c8 === 100 ? '<span class="text-slate-400">ë‚´êµ¬8:</span> <strong>ë¯¸ì‚¬ìš©</strong>' : `<span class="text-slate-400">ë‚´êµ¬8:</span> <strong class="text-blue-400">${c8}ê°•</strong>ë¶€í„°`);
                    if (stop78) ss.push('<span class="text-slate-400">7/8 íŒë‹¨:</span> <strong class="text-orange-400">7ê°• íŒë§¤</strong>');

                    if (ss.length > 0) {
                        bst = `<div class="space-y-1 text-sm bg-slate-700/50 p-3 rounded-lg border border-slate-600">${ss.map(s => `<div>${s}</div>`).join('')}</div>`;
                    }
                }

                let pr;
                // If user is ALREADY at 7/8 and strategy is sell, probabilities are simply 100% at 7.
                if (stop78 && cl === 7 && id === 8) {
                    pr = { 10: 0, 9: 0, 8: 0, 7: 100 };
                } else {
                    // Otherwise simulate prob distribution with the stop strategy
                    pr = sim_stats(tr, cl, id, c10, c9, c8, eq, ud, su, pf, stop78);
                }

                let rb = "";
                if (mp > 0) {
                    let g = fev - mp;
                    let ig = g > 0;
                    let pc = Math.abs(g) / mp * 100;
                    rb = `<div class="px-3 py-1 rounded-full text-xs font-bold border ${ig ? 'bg-green-500/20 text-green-400 border-green-500/50' : 'bg-red-500/20 text-red-400 border-red-500/50'}">${ig ? 'â–² ì´ë“' : 'â–¼ ì†í•´'} ${pc.toFixed(1)}%</div>`;
                }

                const rc = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-indigo-900/20 p-4 rounded-xl border border-indigo-500/30">
                            <div class="text-xs text-indigo-300 mb-1">ê¶Œì¥ ì „ëµ</div>
                            ${bst}
                            <div class="mt-4 pt-4 border-t border-indigo-500/30">
                                <div class="text-xs text-slate-400">ìµœì¢… ê¸°ëŒ€ìˆ˜ìµ</div>
                                <div class="text-2xl font-bold text-yellow-400">${format_gold(fev)}</div>
                                <div class="text-[10px] text-slate-500 mt-1">* ìˆœìˆ˜ìµ</div>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="text-xs text-slate-400 mb-2">ìµœì¢… ë„ë‹¬ í™•ë¥ </div>
                            ${[10, 9, 8, 7].map(lv => {
                    let p = pr[lv];
                    let col = lv === 10 ? 'bg-yellow-500' : lv === 9 ? 'bg-purple-500' : 'bg-red-500';
                    return `
                                    <div class="relative pt-1">
                                        <div class="flex justify-between text-xs mb-1">
                                            <span class="font-bold text-slate-300">${lv}ê°•</span>
                                            <span class="text-slate-400">${p.toFixed(2)}%</span>
                                        </div>
                                        <div class="h-2 flex rounded bg-slate-700">
                                            <div style="width:${p}%" class="${col}"></div>
                                        </div>
                                    </div>`;
                }).join('')}
                            <div class="text-[10px] text-slate-500 text-right">ë‚˜ë¨¸ì§€ ${Math.max(0, 100 - (pr[10] + pr[9] + pr[8] + pr[7])).toFixed(2)}% íŒŒê´´</div>
                        </div>
                    </div>`;

                document.getElementById("roi-badge").innerHTML = rb;
                document.getElementById("roi-badge").classList.remove("hidden");
                document.getElementById("result-content").innerHTML = rc;
                document.getElementById("result-container").classList.remove("hidden");
                document.getElementById("loading").style.display = "none";
                if (window.innerWidth < 768) {
                    document.getElementById("result-container").scrollIntoView({ behavior: 'smooth' });
                }
            }, 500);
        }
    </script>
</body>

</html>
